<div class="row">
  <div class="col-12">
    <mat-card class="cardWithShadow">
      <mat-card-header>
        <mat-card-title>Create Message</mat-card-title>
        <mat-card-subtitle>Create a new message template with dynamic variables</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="messageForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Title</mat-label>
                <input matInput formControlName="title" placeholder="Enter message title">
                <mat-error *ngIf="messageForm.get('title')?.invalid && messageForm.get('title')?.touched">
                  <span *ngIf="messageForm.get('title')?.errors?.['required']">Title is required</span>
                  <span *ngIf="messageForm.get('title')?.errors?.['minlength']">Title must be at least 2 characters</span>
                  <span *ngIf="messageForm.get('title')?.errors?.['maxlength']">Title must be less than 100 characters</span>
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Channel</mat-label>
                <mat-select formControlName="channel">
                  <mat-option [value]="MessageChannel.EMAIL">Email</mat-option>
                  <mat-option [value]="MessageChannel.SMS">SMS</mat-option>
                  <mat-option [value]="MessageChannel.WHATSAPP">WhatsApp</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <app-message-editor
                [contentControl]="messageForm.get('content')!"
                label="Message Content"
                placeholder="Enter your message content. Click variables below to insert them."
                [rows]="6">
              </app-message-editor>
              <mat-error *ngIf="messageForm.get('content')?.invalid && messageForm.get('content')?.touched" class="mt-2">
                <span *ngIf="messageForm.get('content')?.errors?.['required']">Content is required</span>
                <span *ngIf="messageForm.get('content')?.errors?.['maxlength']">Content must be less than 1000 characters</span>
              </mat-error>
            </div>
          </div>


          <div class="row mt-3">
            <div class="col-12">
              <div class="d-flex justify-content-end gap-2">
                <button mat-stroked-button type="button" (click)="onCancel()">
                  Cancel
                </button>
                <button
                  mat-flat-button
                  color="primary"
                  type="submit"
                  [disabled]="isLoading || messageForm.invalid">
                  <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
                  <span *ngIf="!isLoading">Create Message</span>
                </button>
              </div>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
