<div class="manage-policies-dialog">
  <h2 mat-dialog-title>Manage Policies</h2>

  <mat-dialog-content>
    <p class="mb-3 text-muted">Select the policies you want to assign to this role.</p>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center p-4">
      <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
      <span class="ms-2">Loading policies...</span>
    </div>

    <!-- Policies Selection -->
    <div *ngIf="!isLoading">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Select Policies</mat-label>
        <mat-select
          [formControl]="policySelectControl"
          multiple
          [compareWith]="comparePolicies">
          <mat-option *ngFor="let policy of allPolicies" [value]="policy.id">
            <div class="d-flex align-items-center">
              <span class="policy-name">{{ policy.name }}</span>
              <app-badge
                [variant]="policy.type === 'ALLOW' ? 'success' : 'error'"
                class="ms-2 policy-type-chip">
                {{ policy.type }}
              </app-badge>
              <span class="ms-2 text-muted policy-details">
                {{ policy.resource }}:{{ policy.action }}
              </span>
            </div>
            <div class="policy-description text-muted small mt-1">
              {{ policy.description || 'No description' }}
            </div>
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Selected Policies Summary -->
      <div *ngIf="policySelectControl.value && policySelectControl.value.length > 0" class="mt-3">
        <h6>Selected Policies ({{ policySelectControl.value.length }})</h6>
        <div class="selected-policies">
          <mat-chip-listbox>
            <mat-chip
              *ngFor="let policyId of policySelectControl.value"
              [removable]="true"
              (removed)="removePolicy(policyId)">
              {{ getPolicyDisplayName(getPolicyById(policyId)) }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-listbox>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isSubmitting">Cancel</button>
    <button
      mat-flat-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="isSubmitting || !policySelectControl.value || policySelectControl.value.length === 0">
      <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
      <span *ngIf="!isSubmitting">Assign Policies</span>
    </button>
  </mat-dialog-actions>
</div>